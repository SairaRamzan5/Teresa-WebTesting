name: Playwright Tests

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-python@v4
        with:
          python-version: "3.11"
      
      - name: Install dependencies
        run: |
          pip install pytest playwright pytest-html pytest-xdist
      
      - name: Install browsers
        run: |
          python -m playwright install chromium
      
      - name: Run tests with debug
        id: run-tests
        continue-on-error: true  # Continue even if tests fail
        run: |
          echo "=== STARTING TESTS ==="
          echo "Test file check:"
          ls -la tests/
          
          # Run tests with maximum verbosity
          python -m pytest tests/ \
            -v \
            --tb=long \
            --capture=no \
            --html=report.html \
            --self-contained-html \
            --timeout=600 \
            || echo "Tests failed with exit code: $?"
          
          echo "=== TEST COMPLETION ==="
      
      - name: Check for report
        run: |
          echo "Checking for report..."
          if [ -f "report.html" ]; then
            echo "✅ Report generated: report.html"
            ls -lh report.html
          else
            echo "❌ No report.html found"
            echo "Creating empty report for debugging..."
            echo "<html><body><h1>No tests ran</h1></body></html>" > report.html
          fi
      
      - name: Upload report
        uses: actions/upload-artifact@v4
        with:
          name: playwright-report
          path: |
            report.html
            test-results/
            screenshots/
          retention-days: 7
